# SD-JWT が RFC になった：選択的開示の標準化とこれから

> RFC 9901 として正式発行された SD-JWT。そして SD-JWT VC は昨日（2026-02-19）WG Last Call を終えた。デジタルウォレットのクレデンシャルフォーマット競争は次のフェーズへ。

## 背景

「このクレデンシャルを提示するとき、必要な属性だけ見せられないか？」

これは Verifiable Credentials の設計における核心的な問いだ。運転免許証を年齢確認に使うとき、住所や免許番号まで見せるのは明らかにやりすぎだ。この問いへの答えとして、IETF OAuth Working Group が長年開発してきたのが **SD-JWT（Selective Disclosure for JSON Web Tokens）** だ。

2025年11月、そのコア仕様が **RFC 9901** として正式発行された。JWT ベースの選択的開示メカニズムが、IETF の Standards Track RFC として確立された瞬間だ。

## SD-JWT の仕組み

通常の JWT はすべてのクレームをペイロードに平文で含む。SD-JWT はここに巧妙な仕掛けを加える。

開示したくないクレーム（例: 住所、誕生日）は、そのままペイロードに含めない。代わりに：

1. **Disclosure** を作る：`[ソルト, クレーム名, 値]` の配列を base64url エンコードしたもの
2. **ハッシュを埋め込む**：Disclosure の SHA-256 ダイジェストを `_sd` 配列に格納する
3. **提示時に選択**：Holder は必要な Disclosure だけを JWT に添付する

Verifier は「ハッシュが JWT に含まれているか」「Disclosure のハッシュが一致するか」を検証し、選択的開示を確認する。

Key Binding JWT（KB-JWT）を加えれば、「このクレデンシャルはこのデバイスに紐付いている」という所有証明も可能だ（`cnf` クレームに公開鍵を埋め込む）。

シンプルな仕組みながら、実装が JSON/JWT エコシステムに乗るため、開発者への親和性が高い。

## SD-JWT VC：VerifiableCredential としての利用

RFC 9901 はコア仕様だが、これだけでは「どんなフィールドを含む Verifiable Credential として使うか」は定義されていない。

その上位レイヤーが **SD-JWT VC**（`draft-ietf-oauth-sd-jwt-vc`）だ。

現在の状況：
- 最新ドラフト：**draft-ietf-oauth-sd-jwt-vc-14**（2026-02-05 付）
- **WG Last Call：昨日（2026-02-19）終了**
- Q1 2026 の RFC 発行を目標としている

SD-JWT VC が追加する主なフィールド：

| フィールド | 内容 |
|---|---|
| `typ` ヘッダー | `dc+sd-jwt` を必須（旧版では `vc+sd-jwt`） |
| `vct` クレーム | クレデンシャルタイプの識別子（例: `https://credentials.example.com/age-credential`） |
| `iss` クレーム | 発行者の URL |
| `cnf` クレーム | Holder バインディング用の公開鍵 |

`typ` 値が `vc+sd-jwt` から `dc+sd-jwt` に変わった点は実装者が注意すべき変更だ。既存の実装が旧バージョンを参照していると互換性問題が出る。

## SD-JWT vs mdoc：用途に応じた使い分け

eIDAS 2.0 の EUDI Wallet は **SD-JWT VC と mdoc の両方を必須** としている。なぜ1つに統一しないのか。

| 観点 | SD-JWT VC | mdoc (ISO 18013-5) |
|---|---|---|
| 標準化団体 | IETF | ISO/IEC |
| データ形式 | JSON / JWT | CBOR / COSE |
| 選択的開示 | ハッシュベース（提示時にオプトイン） | デフォルト全隠蔽、セッション単位で開示 |
| 得意な場面 | Web API・オンライン認証 | NFC・Bluetooth での対面提示 |
| 開発者親和性 | 高（JWT ライブラリが流用できる） | 中（CBOR バイナリ処理が必要） |

SD-JWT は「ブラウザから API を叩いて年齢確認」のようなオンラインユースケースに向いている。mdoc は「空港で係員のスキャナにかざす」「コンビニの年齢確認端末に提示する」ような対面・オフラインユースケースに強い。

設計哲学の違いも興味深い。SD-JWT はオプトイン型（開示したいクレームを選んで添付する）、mdoc はオプトアウト型（全クレームがデフォルト隠蔽で、セッション中に指定したものだけ開く）だ。

## 生態系の現況

RFC 9901 の発行と WG Last Call 通過により、エコシステムの整備が加速している。

- **EUDI Wallet ARF v2.7.x**：リモートフローに SD-JWT を必須規定。OpenID4VP と組み合わせて RP 認証を実現
- **OpenID4VCI / OpenID4VP**：2025年10月に参照する SD-JWT VC のバージョンをフリーズ。仕様の安定化シグナル
- **OpenID Foundation 自己認証**：2026年2月26日より OpenID4VP 1.0 / OpenID4VCI 1.0 / HAIP 1.0 の適合テストが開始。38 法域の実装者を対象
- **Yivi ウォレット**：SD-JWT VC を「最も広く使われ、実装しやすく、オープンスタンダード」として採用
- **EBSI**（EU Blockchain Services Infrastructure）：SD-JWT を用いた選択的開示フレームワークを提供

また、IETF には `draft-nandakumar-agent-sd-jwt` というドラフトも提出されており、SD-JWT を AI エージェントの発見とアイデンティティ管理に応用しようとしている。NHI（非人間アイデンティティ）の潮流とつながる動きとして注目している。

## 所感

SD-JWT が RFC になったという事実は、デジタルウォレットの実装者にとって「採用しやすくなった」というメッセージだ。まだドラフトの仕様を実装するリスクから解放される。SD-JWT VC も間もなく RFC になる見通しで、eIDAS 2.0 準拠のウォレットを構築する事業者にとって選択肢が明確になった。

気になるのは `typ` 値の変更（`vc+sd-jwt` → `dc+sd-jwt`）だ。仕様が安定化するプロセスでこうした非互換変更が入るのは避けられないが、早期に古いドラフトを参照して実装したプロジェクトの互換性をどう扱うか、エコシステム全体で対処が必要になる。

SD-JWT vs mdoc の「両方必須」という EUDI Wallet の方針は、実装コストを押し上げる。現実には多くの実装者が SD-JWT を優先し、mdoc は対面ユースケースが生じたときに対応する、という優先順位を付けるだろう。この2フォーマット共存状態がいつまで続くかは、対面・物理 ID ユースケースの普及速度に依存する。

## 参考

- [RFC 9901 - Selective Disclosure for JSON Web Tokens (SD-JWT)](https://datatracker.ietf.org/doc/rfc9901/)
- [draft-ietf-oauth-sd-jwt-vc-14 - SD-JWT-based Verifiable Digital Credentials](https://datatracker.ietf.org/doc/draft-ietf-oauth-sd-jwt-vc/)
- [IETF OAuth WG GitHub: oauth-sd-jwt-vc](https://github.com/oauth-wg/oauth-sd-jwt-vc)
- [EUDI Wallet ARF（最新版）](https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/latest/architecture-and-reference-framework-main/)
- [OpenID Sets Feb. 2026 Self-Certification Launch](https://mobileidworld.com/openid-sets-feb-2026-self-certification-launch-for-wallet-and-verifiable-credential-conformance-tests/)
- [Congratulations on RFC 9901! – @_Nat Zone](https://www.sakimura.org/en/2025/11/7764/)
- [EBSI: Selective Disclosure with SD-JWT](https://hub.ebsi.eu/vc-framework/did/selective-disclosure-sd-jwt)
